<html>
    <head>
        <title> Match Mate </title>
        <link rel="stylesheet" type="text/css" href="../static/css/jquery.qtip.min.css">
        <link rel="stylesheet" type="text/css" href="../static/css/main.css">
        <link rel="stylesheet" type="text/css" href="../static/css/icons.css">
        <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
        <style type="text/css">
            body {
                width: 900px;
                margin: 0 auto;
                font-family: 'Quicksand', sans-serif;
            }
            .header {
                margin: 0 auto;
                margin-top: 100px;
            }
            h1.title {
                text-align: center;
                font-size: 50px;
                letter-spacing: 5px;
                font-weight: bold;
                margin-bottom: 0px;
                color: white;
            }
            h2.subtitle {
                text-align: center;
                font-style: italic;
                margin-top: 3px;
                font-size: 15px;
                font-weight: 300;
                color: white;
            }
            .separator {
                border-top: 1px solid white;
                width: 100%;
                height: 1px;
            }

            .main {
                width: 100%;
                margin-top: 10px;
                overflow: auto;
            }

            .list {
                float: left;
                width: 200px;
                height: 200px;
                color: #fff;
                border-right: 1px solid white;
            }

            .filter {
                overflow: auto;
                border-bottom: 1px solid white;
                padding-bottom: 10px;
            }

            .filter .search {
                float: left;
                text-decoration: underline;
            }

            .filter .search:hover {
                cursor: pointer;
                color: #37FDFC;
            }

            .filter .refresh {
                float: right;
            }

            .list .user:hover {
                text-decoration: underline;
                color: #37FDFC;
                cursor: pointer;
            }

            .list .user.highlight {
                background-color: rgba(255, 255, 255, 0.1);
            }

            .vis {
                float: left;
                width: 650px;
                overflow: auto;
            }

            .vis .other {
                margin-left: 5px;
                width: 200px;
                height: 600px;
                float: left;
            }

            .vis .compatibility {
                text-align: center;
                float: left;
                width: 200px;
                height: 600px;
                color: #fff;
                font-size: 50px;
            }

            .vis .me {
                width: 200px;
                height: 600px;
                float: left;
            }
        </style>
    </head>
    <body>
        <svg id="svg-source" height="0" version="1.1" 
            xmlns="http://www.w3.org/2000/svg" 
            xmlns:xlink="http://www.w3.org/1999/xlink" style="position: absolute">
            <g id="rotate" data-iconmelon="80 icons pack:b336822e0b8b406043f4a2143a411957">
              <g>
                <g>
                  <path d="M30.65,15.393c-0.813-0.07-1.533,0.53-1.606,1.344c-0.272,3.062-1.62,5.947-3.798,8.124
            c-2.482,2.482-5.783,3.851-9.294,3.851c-3.126,0-6.082-1.09-8.444-3.081l1.625,0.301c0.091,0.017,0.182,0.025,0.271,0.025
            c0.7,0,1.323-0.499,1.456-1.213c0.146-0.805-0.385-1.576-1.188-1.726l-6.408-1.184c-0.036-0.007-0.07-0.004-0.105-0.01
            c-0.056-0.006-0.109-0.013-0.165-0.013c-0.053,0-0.104,0.007-0.156,0.013c-0.037,0.005-0.074,0.002-0.111,0.01
            c-0.009,0.001-0.017,0.005-0.024,0.007c-0.058,0.011-0.111,0.03-0.165,0.047c-0.039,0.014-0.078,0.023-0.115,0.039
            c-0.053,0.022-0.102,0.051-0.15,0.078c-0.033,0.02-0.068,0.035-0.102,0.057c-0.051,0.035-0.098,0.077-0.145,0.117
            C2,22.2,1.974,22.218,1.951,22.24c-0.048,0.047-0.088,0.101-0.129,0.152c-0.018,0.022-0.037,0.042-0.053,0.065
            c-0.033,0.048-0.058,0.102-0.086,0.154c-0.017,0.033-0.037,0.065-0.053,0.102c-0.017,0.041-0.027,0.086-0.042,0.13
            c-0.017,0.051-0.034,0.102-0.044,0.153c-0.002,0.009-0.006,0.016-0.008,0.023c-0.006,0.036-0.005,0.072-0.008,0.107
            c-0.006,0.055-0.014,0.106-0.014,0.162c0,0.055,0.008,0.108,0.014,0.161c0.003,0.036,0.002,0.071,0.008,0.108l1.185,6.407
            c0.132,0.713,0.755,1.213,1.455,1.213c0.089,0,0.179-0.009,0.271-0.025c0.804-0.149,1.336-0.922,1.188-1.726l-0.334-1.807
            c2.945,2.609,6.684,4.05,10.651,4.05c4.303,0,8.347-1.675,11.388-4.717c2.668-2.668,4.32-6.203,4.654-9.956
            C32.066,16.185,31.465,15.465,30.65,15.393z"></path>
                </g>
                <g>
                  <path d="M2.956,15.264c0.271-3.062,1.62-5.946,3.797-8.124c2.482-2.483,5.782-3.851,9.294-3.851c3.127,0,6.082,1.09,8.445,3.081
            l-1.625-0.301c-0.809-0.149-1.577,0.384-1.725,1.187c-0.148,0.805,0.382,1.577,1.187,1.727l6.407,1.184c0.001,0,0.002,0,0.002,0
            c0.086,0.017,0.176,0.025,0.266,0.025c0,0,0.001,0,0.002,0h0.001c0.09,0,0.179-0.009,0.266-0.025c0.001,0,0.001,0,0.002,0
            c0.006-0.001,0.011-0.004,0.018-0.005c0.085-0.017,0.167-0.041,0.247-0.071c0.031-0.013,0.061-0.028,0.092-0.043
            c0.051-0.024,0.102-0.049,0.15-0.079c0.032-0.021,0.064-0.042,0.094-0.064c0.043-0.031,0.084-0.064,0.123-0.101
            c0.027-0.024,0.054-0.05,0.079-0.077c0.038-0.04,0.073-0.083,0.108-0.127c0.02-0.027,0.041-0.055,0.059-0.083
            c0.031-0.048,0.059-0.1,0.084-0.151c0.016-0.031,0.031-0.061,0.045-0.092c0.021-0.051,0.036-0.104,0.051-0.159
            c0.012-0.036,0.023-0.071,0.031-0.109c0.002-0.009,0.004-0.016,0.006-0.024c0.008-0.036,0.006-0.071,0.01-0.107
            c0.006-0.053,0.013-0.106,0.013-0.162s-0.007-0.108-0.013-0.162c-0.004-0.035-0.002-0.071-0.01-0.107l-1.184-6.407
            c-0.148-0.804-0.918-1.337-1.725-1.188c-0.806,0.148-1.336,0.921-1.188,1.727l0.333,1.805c-2.944-2.608-6.683-4.049-10.651-4.049
            c-4.302,0-8.347,1.674-11.388,4.717c-2.669,2.668-4.321,6.204-4.653,9.956c-0.072,0.816,0.529,1.534,1.344,1.606
            c0.045,0.004,0.09,0.007,0.133,0.007C2.242,16.614,2.889,16.034,2.956,15.264z"></path>
                </g>
              </g>
            </g>
          </svg>


        <div class="header">
            <h1 class="title">{ Match Mate }</h1>
            <h2 class="subtitle">Le Main View</h2>
            <div class="separator"></div>
        </div>
        <div class="main">
            <div class="list">
                <div class="filter">
                    <div class="search">
                        Find best match!
                    </div>
                    <div class="refresh">
                        <div class="iconmelon">
                            <svg viewBox="0 0 32 32">
                                <g filter="">
                                    <use xlink:href="#rotate"></use>
                                </g>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="users">
                </div>
            </div>
            <div class="vis">
                <div id="ovis" class="other"></div>
                <div class="compatibility"></div>
                <div id="mvis" class="me"></div>
            </div>
        </div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="../static/js/matchmate-globals.js"></script>
        <script src="../static/js/matchmate-globals.js"></script>
        <script src="../static/js/matchmate-draw.js"></script>
        <script src="../static/js/jquery.qtip.min.js"></script>
        <script>
            function showCompatibility(uid) {
               $.get('/_do_algorithm', {"user2": uid}, function(data) {
                    data = $.parseJSON(data);
                    var match = data["match"];
                    match = match.toFixed(4);
                    match *= 100.0;

                    d3.select(".compatibility")
                        .text(match + "%");
               });
            }

            function showOtherUser(uid) {
                $.get('/_get_user_answer', {"id": uid}, function(data) {
                   data = $.parseJSON(data);
                   renderMatchbar("ovis", data["answers"]);
                });
            }

            function showMyself() {
                $.get('/_get_user_answer', function(data) {
                   data = $.parseJSON(data);
                   renderMatchbar("mvis", data["answers"]);
                });
            }

            function highlightUser(uid) {
                var users = d3.selectAll('.user')[0];
                var l = users.length;
                uid = uid.toString();
                for (var i = 0; i < l; i += 1) {
                    var user = d3.select(users[i]);
                    var cid = user.attr('uid');
                    user.attr('class', function(d) { return cid === uid ? 'user highlight' : 'user' });
                }
            }

            function displayUserList() {
                $.get('/_get_other_users', function(data) {
                    data = $.parseJSON(data);
                    var users = data.users;

                    $(".users").html('');
                    var list = d3.select('.users');

                    list.selectAll('.user')
                        .data(users)
                        .enter()
                            .append('div')
                            .attr('class', 'user')
                            .attr('uid', function(d) { return d.id; })
                            .text(function(d) { return d.name; })
                            .on('click', function(d) {
                                highlightUser(d.id);
                                showCompatibility(d.id);
                                showOtherUser(d.id);
                            });
                });
            }

            $(".iconmelon").click(function() {
                displayUserList();
            });

            $(".search").click(function() {
                $.get('/_find_best_mate', function(data) {
                    data = $.parseJSON(data);
                    highlightUser(data["id"]);
                    showCompatibility(data["id"]);
                    renderMatchbar("ovis", data["answers"]);
                });
            });

            showMyself();
            displayUserList();
        </script>
    </body>
</html>
